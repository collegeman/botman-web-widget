import{c as l,o as i,a as n,b as k,r as p,t as T,w as V,n as C,d as S,_ as D,e as W,M as H,u as B,f as z,g as I,h as L,i as G,j as v,F as M,k as P,l as J,v as Q,m as N,p as w,q as x,s as g,x as R,y as q,z as X,A as Y,B as Z}from"./_plugin-vue_export-helper-qkm7Y3Cf.js";const tt={class:"flex-grow text-white text-sm text-center cursor-pointer min-h-5"},et=["innerHTML"],st=["innerHTML"],ot={__name:"ChatHeader",emits:["back","close"],setup(t,{emit:e}){const o=e;return(a,d)=>(i(),l("div",{class:S(["shrink-0 p-2 relative",{"rounded-t-lg":!a.$store.state.config.isMobile}]),style:C({backgroundColor:a.$store.state.config.mainColor})},[n("div",tt,[p(a.$slots,"content",{},()=>[n("span",null,T(a.$store.state.title),1)])]),a.$store.getters.showBackButton?(i(),l("button",{key:0,class:"absolute left-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:d[0]||(d[0]=V(m=>o("back"),["prevent"]))},[n("span",{class:"icon block h-4 w-4",innerHTML:a.$store.state.config.icons.back},null,8,et),d[2]||(d[2]=n("span",{class:"sr-only"},"Back",-1))])):k("",!0),n("button",{class:"absolute right-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:d[1]||(d[1]=V(m=>o("close"),["prevent"]))},[n("span",{class:"icon block h-4 w-4",innerHTML:a.$store.state.config.icons.close},null,8,st),d[3]||(d[3]=n("span",{class:"sr-only"},"Close",-1))])],6))}},at={},nt={class:"flex-grow overflow-y-auto"};function it(t,e){return i(),l("div",nt,[p(t.$slots,"default")])}const rt=D(at,[["render",it]]),lt={},ct={class:"w-full"};function dt(t,e){return i(),l("div",ct,[p(t.$slots,"default")])}const ut=D(lt,[["render",dt]]),mt={key:0,class:"flex w-full mb-2 :last:mb-0"},pt={class:"flex-shrink-0 mt-1.5 mr-2"},gt=["src"],ft={key:1,class:"icon w-4 h-4"},ht=["innerHTML"],bt={key:0,class:"py-2 text-sm"},yt={key:1,class:"py-2 px-4 bg-white rounded-lg text-sm"},F={__name:"ChatMessage",props:{message:{type:Object,required:!0},loading:{type:Boolean,default:!1}},setup(t){const e=t;let o=W(e.message.type===H.TypingIndicator);const a=B(),d=z(()=>{let c={};return e.message.from==="chatbot"&&(c.backgroundColor=a.state.config.mainColor),c}),m=z(()=>{var c;return(c=e.message.additionalParameters)!=null&&c.icon?a.state.config.icons[e.message.additionalParameters.icon]:e.message.from==="visitor"?a.state.config.icons.user:a.state.config.icons.bot});return I(()=>{setTimeout(()=>{o.value=e.message.type!==H.TypingIndicator},(e.message.timeout||0)*1e3)}),(c,h)=>{var y;return L(o)?(i(),l("div",mt,[n("div",pt,[n("div",{class:"w-6 h-6 rounded-full bg-gray-500 flex items-center justify-center",style:C(d.value)},[(y=t.message.additionalParameters)!=null&&y.avatar?(i(),l("img",{key:0,src:t.message.additionalParameters.avatar,class:"w-full h-full object-cover"},null,8,gt)):(i(),l("span",ft,[n("span",{innerHTML:m.value},null,8,ht)]))],4)]),t.loading||t.message.type===L(H).TypingIndicator?(i(),l("div",bt,h[0]||(h[0]=[n("div",{class:"my-1 w-3 h-3 rounded-full bg-black animate-pulse"},null,-1)]))):(i(),l("div",yt,T(t.message.text),1))])):k("",!0)}}},$t={class:"p-4"},wt={__name:"ChatMessages",props:{pageId:{type:String,required:!0}},setup(t){const e=B(),o=t;return I(()=>e.state.showChatInput=!0),G(()=>e.state.showChatInput=!1),(a,d)=>(i(),l("div",$t,[p(a.$slots,"default",{},()=>[(i(!0),l(M,null,P(a.$store.state.messages[o.pageId],m=>(i(),v(F,{key:m.id,message:m},null,8,["message"]))),128)),a.$store.state.loading?(i(),v(F,{key:0,loading:!0,message:{from:"chatbot"}})):k("",!0)])]))}},vt=["placeholder"],kt={__name:"ChatInput",emits:["submit"],setup(t,{emit:e}){const o=e,a=W(null),d=c=>{a.value.style.height="auto",a.value.style.height=a.value.scrollHeight+"px"},m=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),o("submit"))};return(c,h)=>(i(),l("div",null,[J(n("textarea",{ref_key:"textarea",ref:a,class:"block w-full border-none outline-none focus:outline-none focus:ring-0 active:outline-none resize-none text-sm rounded-b-lg placeholder:text-gray-300",onInput:d,onKeydown:m,placeholder:c.$store.state.config.placeholderText,"onUpdate:modelValue":h[0]||(h[0]=y=>c.$store.state.input.text=y)},null,40,vt),[[Q,c.$store.state.input.text]])]))}},K={__name:"ChatPage",props:{title:{type:String,default:null},description:{type:String,default:null}},setup(t){const e=B(),o=t;return I(()=>{e.state.title=o.title}),(a,d)=>(i(),l("div",null,[p(a.$slots,"heading"),n("div",{class:S(["relative w-full",{"border-t-[50px]":a.$slots.heading}]),style:C({borderTopColor:a.$store.state.config.mainColor})},[n("div",{class:S(["relative w-full",{"-top-[50px]":a.$slots.heading}])},[p(a.$slots,"default")],2)],6)]))}},_t={},Ct={class:"block w-full bg-white text-black p-6 rounded-lg shadow-md text-left mb-2 transition-transform hover:-translate-y-1 cursor-pointer"},xt={class:"flex items-center"},Mt={class:"mr-4"},Tt={class:"h-5 w-5"},St={class:"text-sm"},Bt={class:"text-xs text-gray-500"};function It(t,e){return i(),l("button",Ct,[p(t.$slots,"content",{},()=>[n("div",xt,[n("div",Mt,[p(t.$slots,"icon",{},()=>[n("div",{class:"h-10 w-10 rounded-full block flex items-center justify-center",style:C({backgroundColor:t.$store.state.config.mainColor})},[n("span",Tt,[p(t.$slots,"icon-svg")])],4)])]),n("div",null,[p(t.$slots,"label",{},()=>[n("div",St,[p(t.$slots,"title")]),n("div",Bt,[p(t.$slots,"description")])])])])])])}const Ht=D(_t,[["render",It]]),Lt={class:"p-4"},Pt={class:"w-10 h-10 relative"},Dt=["src"],Et=["innerHTML"],jt={__name:"Chat",setup(t){const e=B(),o=(s,u=null)=>{e.commit("messages",{message:s,pageId:u})},a=s=>{o({...s,type:"text",from:"chatbot"})},d=s=>{m(s,!1)},m=(s,u=!0)=>{const r=e.state.page;e.commit("loading",!0);let _=0;N({chatServer:e.getters.chatServer(r),...s,perMessageCallback:b=>{o({...b,from:"chatbot",timeout:_+=b.timeout||0},r)},callback:b=>{e.commit("loading",!1),s.callback&&s.callback(b)}}),u&&o({...s,from:"visitor"},r)};window.addEventListener("message",s=>{var u,r,_,b,E,j,A;((u=s.data)==null?void 0:u.method)==="botman-web-widget.widget.toggle"&&($store.state.open=s.data.params.open),((r=s.data)==null?void 0:r.method)==="botman-web-widget.chat.api"&&N({...s.data.params,callback:$=>{w("chat.api.response",$)},errorHandler:$=>{w("chat.api.error",{message:$.message,status:$.response.status,headers:$.response.headers,data:$.response.data})}}),((_=s.data)==null?void 0:_.method)==="botman-web-widget.chat.sayAsBot"&&a(s.data.params),((b=s.data)==null?void 0:b.method)==="botman-web-widget.chat.whisper"&&d(s.data.params),((E=s.data)==null?void 0:E.method)==="botman-web-widget.chat.say"&&m(s.data.params),((j=s.data)==null?void 0:j.method)==="botman-web-widget.chat.page"&&e.commit("page",s.data.params.id),((A=s.data)==null?void 0:A.method)==="botman-web-widget.chat.writeToMessages"&&o(s.data.params)}),I(()=>{w("chat.init"),e.commit("page",e.state.config.defaultPage||"home")});const c=()=>{w("chat.back"),e.commit("page","home")},h=s=>{e.commit("page",s)},y=s=>{m({...e.state.input}),e.commit("resetInput")};return document.addEventListener("keydown",s=>{s.key==="Escape"&&w("chat.esc")}),(s,u)=>(i(),l("div",{class:S(["flex flex-col bg-gray-100 border-gray-200 p-0 h-screen",{"rounded-lg border":!s.$store.state.config.isMobile}])},[x(ot,{onBack:c,onClose:u[0]||(u[0]=r=>L(w)("chat.close"))}),x(rt,null,{default:g(()=>[s.$store.state.page==="home"?(i(),v(K,{key:0},{heading:g(()=>[n("div",{class:"pt-8 pb-4",style:C({backgroundColor:s.$store.state.config.mainColor})},u[1]||(u[1]=[n("h1",{class:"text-lg font-bold text-white text-center mb-2"}," Start a conversation ",-1),n("p",{class:"text-gray-200 text-sm text-center"}," What channel do you prefer? ",-1)]),4)]),default:g(()=>[n("div",Lt,[(i(!0),l(M,null,P(s.$store.state.config.pages,r=>(i(),v(Ht,{key:r.id,onClick:_=>h(r.id)},R({title:g(()=>[q(T(r.buttonTitle||r.title),1)]),description:g(()=>[q(T(r.buttonDescription||r.description),1)]),_:2},[r.avatar?{name:"icon",fn:g(()=>[n("div",Pt,[n("img",{class:"rounded-full w-10 h-10",src:r.avatar},null,8,Dt),u[2]||(u[2]=n("div",{class:"rounded-full w-3 h-3 border border-2 border-white bg-green-500 absolute bottom-0 right-0"},null,-1))])]),key:"0"}:{name:"icon-svg",fn:g(()=>[n("span",{class:"icon",innerHTML:r.icon},null,8,Et)]),key:"1"}]),1032,["onClick"]))),128))])]),_:1})):k("",!0),(i(!0),l(M,null,P(s.$store.state.config.pages,r=>(i(),l(M,null,[s.$store.state.page===r.id?(i(),v(K,{key:r.id,title:r.title},{default:g(()=>[x(wt,{pageId:r.id},null,8,["pageId"])]),_:2},1032,["title"])):k("",!0)],64))),256))]),_:1}),x(ut,null,{default:g(()=>[s.$store.state.showChatInput?(i(),v(kt,{key:0,onSubmit:y})):k("",!0)]),_:1})],2))}},O=X(jt),f=window.botmanWidget;var U;(U=f.pages)!=null&&U.length||(f.pages=[{id:"chat",title:"Chat",buttonTitle:"Chat with our bot",buttonDescription:"Available to help 24/7",icon:f.icons.bot,introMessage:f.introMessage,chatServer:f.chatServer}]);f.pages.forEach(t=>t.pristine=!0);const At=Y({state:{config:f,open:!1,title:null,page:null,messages:f.pages.reduce((t,e)=>(t[e.id]=[],t),{}),conversation:null,input:{text:"",attachment:null},showChatInput:!1,loading:!1},getters:{chatServer:t=>e=>{var o;return((o=t.config.pages.find(a=>a.id===e))==null?void 0:o.chatServer)||t.config.chatServer},showBackButton(t){return t.page!=="home"},pristine:t=>e=>t.config.pages.find(o=>o.id===e).pristine,introMessage:t=>e=>t.config.pages.find(o=>o.id===e).introMessage},mutations:{resetInput(t){t.input.text="",t.input.attachment=null},pristine(t,{pageId:e,value:o}){t.config.pages.find(a=>a.id===e).pristine=o},page(t,e){t.page=e;const o=t.config.pages.find(a=>a.id===e);o!=null&&o.pristine&&(o.pristine=!1,o.introMessage&&Z(()=>setTimeout(()=>t.messages[o.id].push({text:o.introMessage,from:"chatbot"}),500)))},messages(t,{message:e,pageId:o}){t.messages[o||t.page].push(typeof e=="string"?{text:e}:e)},loading(t,e){t.loading=e}}});O.use(At);O.mount("#chat");
