import{c as d,o as r,a as i,b as v,r as p,t as D,w as z,n as M,d as _,_ as Q,e as U,M as P,u as V,f as Z,g as E,h as L,i as ee,j as x,F as H,k as A,l as te,v as se,m as k,p as N,q as B,s as b,x as oe,y as F,z as X,A as ae,B as ne}from"./_plugin-vue_export-helper-D__CIbsV.js";const ie={class:"flex-grow text-white text-sm text-center cursor-pointer min-h-5"},re=["innerHTML"],le=["innerHTML"],ce={__name:"ChatHeader",emits:["back","close"],setup(e,{emit:t}){const n=t;return(s,o)=>(r(),d("div",{class:_(["shrink-0 p-2 relative",{"rounded-t-lg":!s.$store.state.config.isMobile}]),style:M({backgroundColor:s.$store.state.config.mainColor})},[i("div",ie,[p(s.$slots,"content",{},()=>[i("span",null,D(s.$store.state.title),1)])]),s.$store.getters.showBackButton?(r(),d("button",{key:0,class:"absolute left-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:o[0]||(o[0]=z(h=>n("back"),["prevent"]))},[i("span",{class:"icon block h-4 w-4",innerHTML:s.$store.state.config.icons.back},null,8,re),o[2]||(o[2]=i("span",{class:"sr-only"},"Back",-1))])):v("",!0),i("button",{class:"absolute right-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:o[1]||(o[1]=z(h=>n("close"),["prevent"]))},[i("span",{class:"icon block h-4 w-4",innerHTML:s.$store.state.config.icons.close},null,8,le),o[3]||(o[3]=i("span",{class:"sr-only"},"Close",-1))])],6))}},de={class:"flex-grow overflow-y-auto"},ue={__name:"ChatBody",setup(e){return(t,n)=>(r(),d("div",de,[p(t.$slots,"default")]))}},me={},ge={class:"w-full"};function pe(e,t){return r(),d("div",ge,[p(e.$slots,"default")])}const he=Q(me,[["render",pe]]),fe=["data-message-id"],be={key:0,class:"flex-shrink-0 mt-1.5 mr-2"},ye=["src"],we={key:1,class:"icon w-4 h-4"},ve=["innerHTML"],_e={key:1,class:"py-2 text-sm"},$e=["innerHTML"],K={__name:"ChatMessage",props:{message:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["message"],setup(e,{emit:t}){const n=U(null),s=t,o=e;let h=U(o.message.type===P.TypingIndicator);const l=V(),f=Z(()=>{var g;return(g=o.message.additionalParameters)!=null&&g.icon?l.state.config.icons[o.message.additionalParameters.icon]:o.message.from==="visitor"?l.state.config.icons.user:l.state.config.icons.bot});return E(()=>{setTimeout(()=>{var g;h.value=o.message.type!==P.TypingIndicator,s("message",o.message,(g=n.value)==null?void 0:g.$el)},(o.message.timeout||0)*1e3)}),(g,T)=>{var S;return L(h)?(r(),d("li",{key:0,ref_key:"message",ref:n,"data-message-id":o.message.id,class:_(["flex mb-2 :last:mb-0",{"max-w-[85%] ml-auto":o.message.from==="visitor","w-full":o.message.from!=="visitor"}])},[o.message.from!=="visitor"?(r(),d("div",be,[i("div",{class:"w-6 h-6 rounded-full flex items-center justify-center",style:M({backgroundColor:L(l).state.config.mainColor})},[(S=o.message.additionalParameters)!=null&&S.avatar?(r(),d("img",{key:0,src:o.message.additionalParameters.avatar,class:"w-full h-full object-cover"},null,8,ye)):(r(),d("span",we,[i("span",{innerHTML:f.value},null,8,ve)]))],4)])):v("",!0),e.loading||o.message.type===L(P).TypingIndicator?(r(),d("div",_e,T[0]||(T[0]=[i("div",{class:"my-1 w-3 h-3 rounded-full bg-black animate-pulse"},null,-1)]))):o.message.from==="chatbot"?(r(),d("div",{key:2,class:_(["message-text py-2 px-4 rounded-lg text-sm",{"bg-gray-200":o.message.from==="visitor","bg-white":o.message.from!=="visitor"}]),innerHTML:o.message.text},null,10,$e)):(r(),d("div",{key:3,class:_(["message-text py-2 px-4 rounded-lg text-sm",{"bg-gray-200":o.message.from==="visitor","bg-white":o.message.from!=="visitor"}])},D(o.message.text),3))],10,fe)):v("",!0)}}},ke={class:"flex flex-col p-4 list-none"},xe={__name:"ChatMessages",props:{pageId:{type:String,required:!0}},emits:["message"],setup(e,{emit:t}){const n=V(),s=t,o=e;E(()=>n.state.showChatInput=!0),ee(()=>n.state.showChatInput=!1);const h=(l,f)=>{s("message",l,f)};return(l,f)=>(r(),d("ul",ke,[p(l.$slots,"default",{},()=>[(r(!0),d(H,null,A(l.$store.state.messages[o.pageId],g=>(r(),x(K,{key:g.id,message:g,onMessage:h},null,8,["message"]))),128)),l.$store.state.loading?(r(),x(K,{key:0,loading:!0,message:{from:"chatbot"},onMessage:h})):v("",!0)])]))}},Ce=["placeholder"],Me={__name:"ChatInput",emits:["submit"],setup(e,{emit:t}){const n=t,s=U(null),o=l=>{s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px"},h=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),n("submit"))};return(l,f)=>(r(),d("div",null,[te(i("textarea",{ref_key:"textarea",ref:s,class:"block w-full border-none outline-none focus:outline-none focus:ring-0 active:outline-none resize-none text-sm rounded-b-lg placeholder:text-gray-300",onInput:o,onKeydown:h,placeholder:l.$store.state.config.placeholderText,"onUpdate:modelValue":f[0]||(f[0]=g=>l.$store.state.input.text=g)},null,40,Ce),[[se,l.$store.state.input.text]])]))}},W={__name:"ChatPage",props:{id:{type:String,required:!0},title:{type:String,default:null},description:{type:String,default:null}},setup(e){const t=V(),n=e;return E(()=>{t.state.title=n.title}),(s,o)=>(r(),d("div",null,[p(s.$slots,"heading"),i("div",{class:_(["relative w-full",{"border-t-[50px]":s.$slots.heading}]),style:M({borderTopColor:s.$store.state.config.mainColor})},[i("div",{class:_(["relative w-full",{"-top-[50px]":s.$slots.heading}])},[p(s.$slots,"default")],2)],6)]))}},Te={},Se={class:"block w-full bg-white text-black p-6 rounded-lg shadow-md text-left mb-2 transition-transform hover:-translate-y-1 cursor-pointer"},Ie={class:"flex items-center"},Be={class:"mr-4"},Le={class:"h-5 w-5"},He={class:"text-sm"},De={class:"text-xs text-gray-500"};function Ue(e,t){return r(),d("button",Se,[p(e.$slots,"content",{},()=>[i("div",Ie,[i("div",Be,[p(e.$slots,"icon",{},()=>[i("div",{class:"h-10 w-10 rounded-full block flex items-center justify-center",style:M({backgroundColor:e.$store.state.config.mainColor})},[i("span",Le,[p(e.$slots,"icon-svg")])],4)])]),i("div",null,[p(e.$slots,"label",{},()=>[i("div",He,[p(e.$slots,"title")]),i("div",De,[p(e.$slots,"description")])])])])])])}const Ve=Q(Te,[["render",Ue]]),Ee={class:"p-4"},Pe={class:"w-10 h-10 relative"},je=["src"],Ae=["innerHTML"],Re={__name:"Chat",setup(e){const t=V(),n=U(null),s=(a,m=null)=>{t.commit("messages",{message:a,pageId:m})},o=a=>{s({...a,type:"text",from:"chatbot"})},h=a=>{l(a,!1)},l=(a,m=!0)=>{const c=t.state.page,C=setTimeout(()=>t.commit("loading",!0),300);let I=0;N({chatServer:t.getters.chatServer(c),...a,perMessageCallback:w=>{s({...w,from:"chatbot",timeout:I+=w.timeout||0},c)},callback:w=>{clearTimeout(C),t.commit("loading",!1),a.callback&&a.callback(w)}}),m&&s({...a,from:"visitor"},c)};E(()=>{k("chat.init"),t.commit("page",t.state.config.defaultPage||"home")});const f=()=>{k("chat.back"),t.commit("page","home")},g=a=>{t.commit("page",a)},T=a=>{!t.state.loading&&!t.state.waiting&&(l({...t.state.input}),t.commit("resetInput"))},S=(a,m)=>{console.log(a),X(()=>{n.value.$el.scrollTop=m.scrollTop+100})};return document.addEventListener("keydown",a=>{a.key==="Escape"&&k("chat.esc")}),window.addEventListener("message",a=>{var m,c,C,I,w,R,q;((m=a.data)==null?void 0:m.method)==="botman-web-widget.widget.toggle"&&($store.state.open=a.data.params.open),((c=a.data)==null?void 0:c.method)==="botman-web-widget.chat.api"&&N({...a.data.params,callback:$=>{k("chat.api.response",$)},errorHandler:$=>{k("chat.api.error",{message:$.message,status:$.response.status,headers:$.response.headers,data:$.response.data})}}),((C=a.data)==null?void 0:C.method)==="botman-web-widget.chat.sayAsBot"&&o(a.data.params),((I=a.data)==null?void 0:I.method)==="botman-web-widget.chat.whisper"&&h(a.data.params),((w=a.data)==null?void 0:w.method)==="botman-web-widget.chat.say"&&l(a.data.params),((R=a.data)==null?void 0:R.method)==="botman-web-widget.chat.page"&&t.commit("page",a.data.params.id),((q=a.data)==null?void 0:q.method)==="botman-web-widget.chat.writeToMessages"&&s(a.data.params)}),(a,m)=>(r(),d("div",{class:_(["flex flex-col bg-gray-100 border-gray-200 p-0 h-screen",{"rounded-lg border":!a.$store.state.config.isMobile}])},[B(ce,{onBack:f,onClose:m[0]||(m[0]=c=>L(k)("chat.close"))}),B(ue,{ref_key:"body",ref:n},{default:b(()=>[a.$store.state.page==="home"?(r(),x(W,{key:0,id:"home"},{heading:b(()=>[i("div",{class:"pt-8 pb-4",style:M({backgroundColor:a.$store.state.config.mainColor})},m[1]||(m[1]=[i("h1",{class:"text-lg font-bold text-white text-center mb-2"}," Start a conversation ",-1),i("p",{class:"text-gray-200 text-sm text-center"}," What channel do you prefer? ",-1)]),4)]),default:b(()=>[i("div",Ee,[(r(!0),d(H,null,A(a.$store.state.config.pages,c=>(r(),x(Ve,{key:c.id,onClick:C=>g(c.id)},oe({title:b(()=>[F(D(c.buttonTitle||c.title),1)]),description:b(()=>[F(D(c.buttonDescription||c.description),1)]),_:2},[c.avatar?{name:"icon",fn:b(()=>[i("div",Pe,[i("img",{class:"rounded-full w-10 h-10",src:c.avatar},null,8,je),m[2]||(m[2]=i("div",{class:"rounded-full w-3 h-3 border border-2 border-white bg-green-500 absolute bottom-0 right-0"},null,-1))])]),key:"0"}:{name:"icon-svg",fn:b(()=>[i("span",{class:"icon",innerHTML:c.icon},null,8,Ae)]),key:"1"}]),1032,["onClick"]))),128))])]),_:1})):v("",!0),(r(!0),d(H,null,A(a.$store.state.config.pages,c=>(r(),d(H,null,[a.$store.state.page===c.id?(r(),x(W,{key:c.id,id:c.id,title:c.title},{default:b(()=>[B(xe,{pageId:c.id,onMessage:S},null,8,["pageId"])]),_:2},1032,["id","title"])):v("",!0)],64))),256))]),_:1},512),B(he,null,{default:b(()=>[a.$store.state.showChatInput?(r(),x(Me,{key:0,onSubmit:T})):v("",!0)]),_:1})],2))}},u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function qe(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}let j;const ze=new Uint8Array(16);function Ne(){if(!j){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");j=crypto.getRandomValues.bind(crypto)}return j(ze)}const Fe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),O={randomUUID:Fe};function G(e,t,n){var o;if(O.randomUUID&&!e)return O.randomUUID();e=e||{};const s=e.random??((o=e.rng)==null?void 0:o.call(e))??Ne();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,qe(s)}const Y=ae(Re),y=window.botmanWidget;var J;(J=y.pages)!=null&&J.length||(y.pages=[{id:"chat",title:"Chat",buttonTitle:"Chat with our bot",buttonDescription:"Available to help 24/7",icon:y.icons.bot,introMessage:y.introMessage,chatServer:y.chatServer}]);y.pages.forEach(e=>e.pristine=!0);const Ke=ne({state:{config:y,open:!1,title:null,page:null,messages:y.pages.reduce((e,t)=>(e[t.id]=[],e),{}),conversation:null,input:{text:"",attachment:null},showChatInput:!1,loading:!1,waiting:!1},getters:{chatServer:e=>t=>{var n;return((n=e.config.pages.find(s=>s.id===t))==null?void 0:n.chatServer)||e.config.chatServer},showBackButton(e){return e.page!=="home"},pristine:e=>t=>e.config.pages.find(n=>n.id===t).pristine,introMessage:e=>t=>e.config.pages.find(n=>n.id===t).introMessage},mutations:{resetInput(e){e.input.text="",e.input.attachment=null},pristine(e,{pageId:t,value:n}){e.config.pages.find(s=>s.id===t).pristine=n},page(e,t){e.page=t;const n=e.config.pages.find(s=>s.id===t);n!=null&&n.pristine&&(n.pristine=!1,n.introMessage&&X(()=>setTimeout(()=>e.messages[n.id].push({id:G(),time:new Date().getTime(),text:n.introMessage,from:"chatbot"}),500)))},messages(e,{message:t,pageId:n}){let s=typeof t=="string"?{text:t}:t;typeof s.id>"u"&&(s.id=G()),typeof s.time>"u"&&(s.time=new Date().getTime()),e.messages[n||e.page].push(s)},loading(e,t){e.loading=t},waiting(e,t){e.waiting=t}}});Y.use(Ke);Y.mount("#chat");
