import{c,o as r,a as n,b as y,r as u,t as k,w as E,n as x,d as C,_ as B,u as M,e as I,f as q,F as v,g as T,h as w,i as F,j as K,v as P,k as A,l as f,m as _,p as U,q as g,s as O,x as V,y as G,z as J,A as Q}from"./_plugin-vue_export-helper-ByImZxjQ.js";const R={class:"flex-grow text-white text-sm text-center cursor-pointer min-h-5"},X=["innerHTML"],Y=["innerHTML"],Z={__name:"ChatHeader",emits:["back","close"],setup(t,{emit:e}){const o=e;return(a,l)=>(r(),c("div",{class:C(["shrink-0 p-2 relative",{"rounded-t-lg":!a.$store.state.config.isMobile}]),style:x({backgroundColor:a.$store.state.config.mainColor})},[n("div",R,[u(a.$slots,"content",{},()=>[n("span",null,k(a.$store.state.title),1)])]),a.$store.getters.showBackButton?(r(),c("button",{key:0,class:"absolute left-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:l[0]||(l[0]=E(p=>o("back"),["prevent"]))},[n("span",{class:"icon block h-4 w-4",innerHTML:a.$store.state.config.icons.back},null,8,X),l[2]||(l[2]=n("span",{class:"sr-only"},"Back",-1))])):y("",!0),n("button",{class:"absolute right-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:l[1]||(l[1]=E(p=>o("close"),["prevent"]))},[n("span",{class:"icon block h-4 w-4",innerHTML:a.$store.state.config.icons.close},null,8,Y),l[3]||(l[3]=n("span",{class:"sr-only"},"Close",-1))])],6))}},tt={},et={class:"flex-grow overflow-y-auto"};function st(t,e){return r(),c("div",et,[u(t.$slots,"default")])}const ot=B(tt,[["render",st]]),nt={},at={class:"w-full"};function it(t,e){return r(),c("div",at,[u(t.$slots,"default")])}const rt=B(nt,[["render",it]]),lt={class:"flex w-full"},ct={class:"flex-shrink-0 mr-2"},dt={class:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center"},ut={class:"icon w-6 h-6"},pt=["innerHTML"],ht={class:"py-2 px-4 bg-white rounded-lg text-sm mb-4 :last:mb-0"},gt={__name:"ChatMessage",props:{message:{type:Object,required:!0}},setup(t){return M(),(e,o)=>(r(),c("div",lt,[n("div",ct,[n("div",dt,[n("span",ut,[n("span",{innerHTML:e.$store.state.config.icons.user},null,8,pt)])])]),n("div",ht,k(t.message.text),1)]))}},mt={class:"p-4"},ft={__name:"ChatMessages",props:{pageId:{type:String,required:!0}},setup(t){const e=M(),o=t;return I(()=>e.state.showChatInput=!0),q(()=>e.state.showChatInput=!1),(a,l)=>(r(),c("div",mt,[u(a.$slots,"default",{},()=>[(r(!0),c(v,null,T(a.$store.state.messages[o.pageId],p=>(r(),w(gt,{key:p.id,message:p},null,8,["message"]))),128))])]))}},bt=["placeholder"],wt={__name:"ChatInput",emits:["submit"],setup(t,{emit:e}){const o=e,a=F(null),l=h=>{a.value.style.height="auto",a.value.style.height=a.value.scrollHeight+"px"},p=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),o("submit"))};return(h,$)=>(r(),c("div",null,[K(n("textarea",{ref_key:"textarea",ref:a,class:"block w-full border-none outline-none focus:outline-none focus:ring-0 active:outline-none resize-none text-sm rounded-b-lg placeholder:text-gray-300",onInput:l,onKeydown:p,placeholder:h.$store.state.config.placeholderText,"onUpdate:modelValue":$[0]||($[0]=S=>h.$store.state.input.text=S)},null,40,bt),[[P,h.$store.state.input.text]])]))}},j={__name:"ChatPage",props:{title:{type:String,default:null},description:{type:String,default:null}},setup(t){const e=M(),o=t;return I(()=>{e.state.title=o.title}),(a,l)=>(r(),c("div",null,[u(a.$slots,"heading"),n("div",{class:C(["relative w-full",{"border-t-[50px]":a.$slots.heading}]),style:x({borderTopColor:a.$store.state.config.mainColor})},[n("div",{class:C(["relative w-full",{"-top-[50px]":a.$slots.heading}])},[u(a.$slots,"default")],2)],6)]))}},$t={},_t={class:"block w-full bg-white text-black p-6 rounded-lg shadow-md text-left mb-2 transition-transform hover:-translate-y-1 cursor-pointer"},yt={class:"flex items-center"},vt={class:"mr-4"},kt={class:"h-5 w-5"},Ct={class:"text-sm"},xt={class:"text-xs text-gray-500"};function Mt(t,e){return r(),c("button",_t,[u(t.$slots,"content",{},()=>[n("div",yt,[n("div",vt,[u(t.$slots,"icon",{},()=>[n("div",{class:"h-10 w-10 rounded-full block flex items-center justify-center",style:x({backgroundColor:t.$store.state.config.mainColor})},[n("span",kt,[u(t.$slots,"icon-svg")])],4)])]),n("div",null,[u(t.$slots,"label",{},()=>[n("div",Ct,[u(t.$slots,"title")]),n("div",xt,[u(t.$slots,"description")])])])])])])}const St=B($t,[["render",Mt]]),Tt={class:"p-4"},Bt={class:"w-10 h-10 relative"},It=["src"],Ht=["innerHTML"],Lt={__name:"Chat",setup(t){const e=M(),o=(s,d=null)=>{e.commit("messages",{message:s,pageId:d})},a=s=>{o({...s,type:"text",from:"chatbot"})},l=s=>{p(s,!1)},p=(s,d=!0)=>{const i=e.state.page;A({chatServer:e.getters.chatServer(i),...s,perMessageCallback:b=>{o(b,i)}}),d&&o(s,i)};window.addEventListener("message",s=>{var d,i,b,H,L,W,D;((d=s.data)==null?void 0:d.method)==="botman-web-widget.widget.toggle"&&($store.state.open=s.data.params.open),((i=s.data)==null?void 0:i.method)==="botman-web-widget.chat.api"&&A({...s.data.params,callback:m=>{f("chat.api.response",m)},errorHandler:m=>{f("chat.api.error",{message:m.message,status:m.response.status,headers:m.response.headers,data:m.response.data})}}),((b=s.data)==null?void 0:b.method)==="botman-web-widget.chat.sayAsBot"&&a(s.data.params),((H=s.data)==null?void 0:H.method)==="botman-web-widget.chat.whisper"&&l(s.data.params),((L=s.data)==null?void 0:L.method)==="botman-web-widget.chat.say"&&p(s.data.params),((W=s.data)==null?void 0:W.method)==="botman-web-widget.chat.page"&&e.commit("page",s.data.params.id),((D=s.data)==null?void 0:D.method)==="botman-web-widget.chat.writeToMessages"&&o(s.data.params)}),I(()=>f("chat.init"));const h=()=>{f("chat.back"),e.commit("page","home")},$=s=>{e.commit("page",s)},S=s=>{p({...e.state.input}),e.commit("resetInput")};return document.addEventListener("keydown",s=>{s.key==="Escape"&&f("chat.esc")}),(s,d)=>(r(),c("div",{class:C(["flex flex-col bg-gray-100 border-gray-200 p-0 h-screen",{"rounded-lg border":!s.$store.state.config.isMobile}])},[_(Z,{onBack:h,onClose:d[0]||(d[0]=i=>U(f)("chat.close"))}),_(ot,null,{default:g(()=>[s.$store.state.page==="home"?(r(),w(j,{key:0},{heading:g(()=>[n("div",{class:"pt-8 pb-4",style:x({backgroundColor:s.$store.state.config.mainColor})},d[1]||(d[1]=[n("h1",{class:"text-lg font-bold text-white text-center mb-2"}," Start a conversation ",-1),n("p",{class:"text-gray-200 text-sm text-center"}," What channel do you prefer? ",-1)]),4)]),default:g(()=>[n("div",Tt,[(r(!0),c(v,null,T(s.$store.state.config.pages,i=>(r(),w(St,{key:i.id,onClick:b=>$(i.id)},O({title:g(()=>[V(k(i.buttonTitle||i.title),1)]),description:g(()=>[V(k(i.buttonDescription||i.description),1)]),_:2},[i.avatar?{name:"icon",fn:g(()=>[n("div",Bt,[n("img",{class:"rounded-full w-10 h-10",src:i.avatar},null,8,It),d[2]||(d[2]=n("div",{class:"rounded-full w-3 h-3 border border-2 border-white bg-green-500 absolute bottom-0 right-0"},null,-1))])]),key:"0"}:{name:"icon-svg",fn:g(()=>[n("span",{class:"icon",innerHTML:i.icon},null,8,Ht)]),key:"1"}]),1032,["onClick"]))),128))])]),_:1})):y("",!0),(r(!0),c(v,null,T(s.$store.state.config.pages,i=>(r(),c(v,null,[s.$store.state.page===i.id?(r(),w(j,{key:i.id,title:i.title},{default:g(()=>[_(ft,{pageId:i.id},null,8,["pageId"])]),_:2},1032,["title"])):y("",!0)],64))),256))]),_:1}),_(rt,null,{default:g(()=>[s.$store.state.showChatInput?(r(),w(wt,{key:0,onSubmit:S})):y("",!0)]),_:1})],2))}},N=G(Lt);var z;(z=window.botmanWidget.pages)!=null&&z.length||(window.botmanWidget.pages=[{id:"chat",title:"Chat",buttonTitle:"Chat with our bot",buttonDescription:"Available to help 24/7",icon:window.botmanWidget.icons.bot,introMessage:window.botmanWidget.introMessage,chatServer:window.botmanWidget.chatServer}]);window.botmanWidget.pages.forEach(t=>t.pristine=!0);const Wt=J({state:{config:window.botmanWidget,open:!1,title:null,page:"home",messages:window.botmanWidget.pages.reduce((t,e)=>(t[e.id]=[],t),{}),conversation:null,input:{text:"",attachment:null},showChatInput:!1},getters:{chatServer:t=>e=>{var o;return((o=t.config.pages.find(a=>a.id===e))==null?void 0:o.chatServer)||t.config.chatServer},showBackButton(t){return t.page!=="home"},pristine:t=>e=>t.config.pages.find(o=>o.id===e).pristine,introMessage:t=>e=>t.config.pages.find(o=>o.id===e).introMessage},mutations:{resetInput(t){t.input.text="",t.input.attachment=null},pristine(t,{pageId:e,value:o}){t.config.pages.find(a=>a.id===e).pristine=o},page(t,e){t.page=e;const o=t.config.pages.find(a=>a.id===e);o.pristine&&(o.pristine=!1,o.introMessage&&Q(()=>setTimeout(()=>t.messages[o.id].push({text:o.introMessage,from:"chatbot"}),500)))},messages(t,{message:e,pageId:o}){t.messages[o||t.page].push(typeof e=="string"?{text:e}:e)}}});N.use(Wt);N.mount("#chat");
