import{c as d,o as r,a as i,b as v,r as f,t as D,w as N,n as M,d as _,_ as Q,e as U,M as E,u as P,f as Z,g as V,h as H,i as ee,j as $,F as L,k as R,l as te,v as se,m as C,p as F,q as B,s as y,x as oe,y as K,z as X,A as ae,B as ne}from"./_plugin-vue_export-helper-D__CIbsV.js";const ie={class:"flex-grow text-white text-sm text-center cursor-pointer min-h-5"},re=["innerHTML"],le=["innerHTML"],ce={__name:"ChatHeader",emits:["back","close"],setup(e,{emit:t}){const n=t;return(s,a)=>(r(),d("div",{class:_(["shrink-0 p-2 relative",{"rounded-t-lg":!s.$store.state.config.isMobile}]),style:M({backgroundColor:s.$store.state.config.mainColor})},[i("div",ie,[f(s.$slots,"content",{},()=>[i("span",null,D(s.$store.state.title),1)])]),s.$store.getters.showBackButton?(r(),d("button",{key:0,class:"absolute left-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:a[0]||(a[0]=N(p=>n("back"),["prevent"]))},[i("span",{class:"icon block h-4 w-4",innerHTML:s.$store.state.config.icons.back},null,8,re),a[2]||(a[2]=i("span",{class:"sr-only"},"Back",-1))])):v("",!0),i("button",{class:"absolute right-2 top-1/2 -translate-y-1/2 outline-none text-white text-sm",onClick:a[1]||(a[1]=N(p=>n("close"),["prevent"]))},[i("span",{class:"icon block h-4 w-4",innerHTML:s.$store.state.config.icons.close},null,8,le),a[3]||(a[3]=i("span",{class:"sr-only"},"Close",-1))])],6))}},de={class:"flex-grow overflow-y-auto"},ue={__name:"ChatBody",setup(e){return(t,n)=>(r(),d("div",de,[f(t.$slots,"default")]))}},me={},ge={class:"w-full"};function pe(e,t){return r(),d("div",ge,[f(e.$slots,"default")])}const fe=Q(me,[["render",pe]]),he=["data-message-id"],be={key:0,class:"flex-shrink-0 mt-1.5 mr-2"},ye=["src"],we={key:1,class:"icon w-4 h-4"},ve=["innerHTML"],$e={key:1,class:"py-2 text-sm"},_e=["innerHTML"],j={__name:"ChatMessage",props:{message:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["message"],setup(e,{emit:t}){const n=U(null),s=t,a=e;let p=U(a.message.type===E.TypingIndicator);const l=P(),b=Z(()=>{var g;return(g=a.message.additionalParameters)!=null&&g.icon?l.state.config.icons[a.message.additionalParameters.icon]:a.message.from==="visitor"?l.state.config.icons.user:l.state.config.icons.bot});return V(()=>{setTimeout(()=>{var g;p.value=a.message.type!==E.TypingIndicator,s("message",a.message,(g=n.value)==null?void 0:g.$el)},(a.message.timeout||0)*1e3)}),(g,T)=>{var S;return H(p)?(r(),d("li",{key:0,ref_key:"message",ref:n,"data-message-id":a.message.id,class:_(["flex mb-2 :last:mb-0",{"max-w-[85%] ml-auto":a.message.from==="visitor","w-full":a.message.from!=="visitor"}])},[a.message.from!=="visitor"?(r(),d("div",be,[i("div",{class:"w-6 h-6 rounded-full flex items-center justify-center",style:M({backgroundColor:H(l).state.config.mainColor})},[(S=a.message.additionalParameters)!=null&&S.avatar?(r(),d("img",{key:0,src:a.message.additionalParameters.avatar,class:"w-full h-full object-cover"},null,8,ye)):(r(),d("span",we,[i("span",{innerHTML:b.value},null,8,ve)]))],4)])):v("",!0),e.loading||a.message.type===H(E).TypingIndicator?(r(),d("div",$e,T[0]||(T[0]=[i("div",{class:"my-1 w-3 h-3 rounded-full bg-black animate-pulse"},null,-1)]))):a.message.from==="chatbot"?(r(),d("div",{key:2,class:_(["message-text py-2 px-4 rounded-lg text-sm",{"bg-gray-200":a.message.from==="visitor","bg-white":a.message.from!=="visitor"}]),innerHTML:a.message.text},null,10,_e)):(r(),d("div",{key:3,class:_(["message-text py-2 px-4 rounded-lg text-sm",{"bg-gray-200":a.message.from==="visitor","bg-white":a.message.from!=="visitor"}])},D(a.message.text),3))],10,he)):v("",!0)}}},ke={class:"flex flex-col p-4 list-none"},xe={__name:"ChatMessages",props:{pageId:{type:String,required:!0}},emits:["message"],setup(e,{emit:t}){const n=P(),s=t,a=e;V(()=>n.state.showChatInput=!0),ee(()=>n.state.showChatInput=!1);const p=(l,b)=>{s("message",l,b)};return(l,b)=>(r(),d("ul",ke,[f(l.$slots,"default",{},()=>[(r(!0),d(L,null,R(l.$store.state.messages[a.pageId],g=>(r(),$(j,{key:g.id,message:g,onMessage:p},null,8,["message"]))),128)),l.$store.state.loading?(r(),$(j,{key:0,loading:!0,message:{from:"chatbot"},onMessage:p})):v("",!0),l.$store.state.error?(r(),$(j,{key:1,message:{from:"chatbot",text:"<span class='text-red-500'>Oops! Please try again.</span>"},onMessage:p})):v("",!0)])]))}},Ce=["placeholder"],Me={__name:"ChatInput",emits:["submit"],setup(e,{emit:t}){const n=t,s=U(null),a=l=>{s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px"},p=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),n("submit"))};return(l,b)=>(r(),d("div",null,[te(i("textarea",{ref_key:"textarea",ref:s,class:"block w-full border-none outline-none focus:outline-none focus:ring-0 active:outline-none resize-none text-sm rounded-b-lg placeholder:text-gray-300",onInput:a,onKeydown:p,placeholder:l.$store.state.config.placeholderText,"onUpdate:modelValue":b[0]||(b[0]=g=>l.$store.state.input.text=g)},null,40,Ce),[[se,l.$store.state.input.text]])]))}},O={__name:"ChatPage",props:{id:{type:String,required:!0},title:{type:String,default:null},description:{type:String,default:null}},setup(e){const t=P(),n=e;return V(()=>{t.state.title=n.title}),(s,a)=>(r(),d("div",null,[f(s.$slots,"heading"),i("div",{class:_(["relative w-full",{"border-t-[50px]":s.$slots.heading}]),style:M({borderTopColor:s.$store.state.config.mainColor})},[i("div",{class:_(["relative w-full",{"-top-[50px]":s.$slots.heading}])},[f(s.$slots,"default")],2)],6)]))}},Te={},Se={class:"block w-full bg-white text-black p-6 rounded-lg shadow-md text-left mb-2 transition-transform hover:-translate-y-1 cursor-pointer"},Ie={class:"flex items-center"},Be={class:"mr-4"},He={class:"h-5 w-5"},Le={class:"text-sm"},De={class:"text-xs text-gray-500"};function Ue(e,t){return r(),d("button",Se,[f(e.$slots,"content",{},()=>[i("div",Ie,[i("div",Be,[f(e.$slots,"icon",{},()=>[i("div",{class:"h-10 w-10 rounded-full block flex items-center justify-center",style:M({backgroundColor:e.$store.state.config.mainColor})},[i("span",He,[f(e.$slots,"icon-svg")])],4)])]),i("div",null,[f(e.$slots,"label",{},()=>[i("div",Le,[f(e.$slots,"title")]),i("div",De,[f(e.$slots,"description")])])])])])])}const Pe=Q(Te,[["render",Ue]]),Ve={class:"p-4"},Ee={class:"w-10 h-10 relative"},je=["src"],Ae=["innerHTML"],Re={__name:"Chat",setup(e){const t=P(),n=U(null),s=(o,m=null)=>{t.commit("messages",{message:o,pageId:m})},a=o=>{s({...o,type:"text",from:"chatbot"})},p=o=>{l(o,!1)},l=(o,m=!0)=>{const c=t.state.page;t.commit("error",!1);const k=setTimeout(()=>t.commit("loading",!0),300);let I=0;F({chatServer:t.getters.chatServer(c),...o,perMessageCallback:h=>{s({...h,from:"chatbot",timeout:I+=h.timeout||0},c)},callback:h=>{clearTimeout(k),t.commit("loading",!1),o.callback&&o.callback(h)},errorHandler:h=>{clearTimeout(k),t.commit("loading",!1),t.commit("error",h),o.errorHandler&&o.errorHandler(h),o.from==="visitor"&&m&&(t.state.input=o)}}),m&&s({...o,from:"visitor"},c)};V(()=>{C("chat.init"),t.commit("page",t.state.config.defaultPage||"home")});const b=()=>{C("chat.back"),t.commit("page","home")},g=o=>{t.commit("page",o)},T=o=>{!t.state.loading&&!t.state.waiting&&(l({...t.state.input}),t.commit("resetInput"))},S=(o,m)=>{console.log(o),X(()=>{n.value.$el.scrollTop=m.scrollTop+100})};return document.addEventListener("keydown",o=>{o.key==="Escape"&&C("chat.esc")}),window.addEventListener("message",o=>{var m,c,k,I,h,q,z;((m=o.data)==null?void 0:m.method)==="botman-web-widget.widget.toggle"&&($store.state.open=o.data.params.open),((c=o.data)==null?void 0:c.method)==="botman-web-widget.chat.api"&&F({...o.data.params,callback:x=>{C("chat.api.response",x)},errorHandler:x=>{C("chat.api.error",{message:x.message,status:x.response.status,headers:x.response.headers,data:x.response.data})}}),((k=o.data)==null?void 0:k.method)==="botman-web-widget.chat.sayAsBot"&&a(o.data.params),((I=o.data)==null?void 0:I.method)==="botman-web-widget.chat.whisper"&&p(o.data.params),((h=o.data)==null?void 0:h.method)==="botman-web-widget.chat.say"&&l(o.data.params),((q=o.data)==null?void 0:q.method)==="botman-web-widget.chat.page"&&t.commit("page",o.data.params.id),((z=o.data)==null?void 0:z.method)==="botman-web-widget.chat.writeToMessages"&&s(o.data.params)}),(o,m)=>(r(),d("div",{class:_(["flex flex-col bg-gray-100 border-gray-200 p-0 h-screen",{"rounded-lg border":!o.$store.state.config.isMobile}])},[B(ce,{onBack:b,onClose:m[0]||(m[0]=c=>H(C)("chat.close"))}),B(ue,{ref_key:"body",ref:n},{default:y(()=>[o.$store.state.page==="home"?(r(),$(O,{key:0,id:"home"},{heading:y(()=>[i("div",{class:"pt-8 pb-4",style:M({backgroundColor:o.$store.state.config.mainColor})},m[1]||(m[1]=[i("h1",{class:"text-lg font-bold text-white text-center mb-2"}," Start a conversation ",-1),i("p",{class:"text-gray-200 text-sm text-center"}," What channel do you prefer? ",-1)]),4)]),default:y(()=>[i("div",Ve,[(r(!0),d(L,null,R(o.$store.state.config.pages,c=>(r(),$(Pe,{key:c.id,onClick:k=>g(c.id)},oe({title:y(()=>[K(D(c.buttonTitle||c.title),1)]),description:y(()=>[K(D(c.buttonDescription||c.description),1)]),_:2},[c.avatar?{name:"icon",fn:y(()=>[i("div",Ee,[i("img",{class:"rounded-full w-10 h-10",src:c.avatar},null,8,je),m[2]||(m[2]=i("div",{class:"rounded-full w-3 h-3 border border-2 border-white bg-green-500 absolute bottom-0 right-0"},null,-1))])]),key:"0"}:{name:"icon-svg",fn:y(()=>[i("span",{class:"icon",innerHTML:c.icon},null,8,Ae)]),key:"1"}]),1032,["onClick"]))),128))])]),_:1})):v("",!0),(r(!0),d(L,null,R(o.$store.state.config.pages,c=>(r(),d(L,null,[o.$store.state.page===c.id?(r(),$(O,{key:c.id,id:c.id,title:c.title},{default:y(()=>[B(xe,{pageId:c.id,onMessage:S},null,8,["pageId"])]),_:2},1032,["id","title"])):v("",!0)],64))),256))]),_:1},512),B(fe,null,{default:y(()=>[o.$store.state.showChatInput?(r(),$(Me,{key:0,onSubmit:T})):v("",!0)]),_:1})],2))}},u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function qe(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}let A;const ze=new Uint8Array(16);function Ne(){if(!A){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");A=crypto.getRandomValues.bind(crypto)}return A(ze)}const Fe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:Fe};function G(e,t,n){var a;if(W.randomUUID&&!e)return W.randomUUID();e=e||{};const s=e.random??((a=e.rng)==null?void 0:a.call(e))??Ne();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,qe(s)}const Y=ae(Re),w=window.botmanWidget;var J;(J=w.pages)!=null&&J.length||(w.pages=[{id:"chat",title:"Chat",buttonTitle:"Chat with our bot",buttonDescription:"Available to help 24/7",icon:w.icons.bot,introMessage:w.introMessage,chatServer:w.chatServer}]);w.pages.forEach(e=>e.pristine=!0);const Ke=ne({state:{config:w,open:!1,title:null,page:null,messages:w.pages.reduce((e,t)=>(e[t.id]=[],e),{}),conversation:null,input:{text:"",attachment:null},showChatInput:!1,loading:!1,waiting:!1,error:!1},getters:{chatServer:e=>t=>{var n;return((n=e.config.pages.find(s=>s.id===t))==null?void 0:n.chatServer)||e.config.chatServer},showBackButton(e){return e.page!=="home"},pristine:e=>t=>e.config.pages.find(n=>n.id===t).pristine,introMessage:e=>t=>e.config.pages.find(n=>n.id===t).introMessage},mutations:{resetInput(e){e.input.text="",e.input.attachment=null},pristine(e,{pageId:t,value:n}){e.config.pages.find(s=>s.id===t).pristine=n},page(e,t){e.page=t;const n=e.config.pages.find(s=>s.id===t);n!=null&&n.pristine&&(n.pristine=!1,n.introMessage&&X(()=>setTimeout(()=>e.messages[n.id].push({id:G(),time:new Date().getTime(),text:n.introMessage,from:"chatbot"}),500)))},messages(e,{message:t,pageId:n}){let s=typeof t=="string"?{text:t}:t;typeof s.id>"u"&&(s.id=G()),typeof s.time>"u"&&(s.time=new Date().getTime()),e.messages[n||e.page].push(s)},loading(e,t){e.loading=t},waiting(e,t){e.waiting=t},error(e,t){e.error=t}}});Y.use(Ke);Y.mount("#chat");
